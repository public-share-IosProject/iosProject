var webLib = function () {
    var debugStatus=false;
    var debugToken = "45f3a4cfd719139065e70dd47e67cfff";
    var storageKey="local";

    this.uploadFlagTask="Task";
    this.uploadFlagHead="Head";
    this.uploadFlagCard="Card";

    /**
     * 初始化函数
     * @return {[type]} [description]
     */
    this.init = function (callback,auth) {
        var self=this;
        debugStatus=true;
        var callback=callback||function(){}
        var auth=auth||false;
        if (debugStatus) {
            window.webEvn = new Object();
            window.webEvn.token = debugToken;
            callback();
            return;
        }
        if(auth){
            this.Auth(function(data){
                if(!data.status){
                }
            });
        }
        //注册页面加载完成需要注册的函数
        WebViewJavascriptBridge.callHandler("PageLoadingFinish", {}, function (responseData) {
            console.log("初始化"+JSON.stringify(responseData));
            window.webEvn=responseData;
            callback();
        });
    }

    this.debug = function (is) {
        debugStatus = is;
    }

    /**
     * 设置数据值到webview中进行保存
     * @param {[type]} data [description]
     */
    this.setData = function (data, callback) {
        var callback = callback || function(){};
        if (debugStatus) {
            var data=JSON.stringify(data);
            localStorage.setItem(storageKey,data);
            callback();
            return;
        }
        WebViewJavascriptBridge.callHandler("SetData", data, function (responseData) {
           callback();
        });
    }
    this.getData = function () {
        if(debugStatus){
            var data= localStorage.getItem(storageKey);
            return JSON.parse(data);
        }
        return window.webEvn;
    }

    this.reflushData=function(callback){
        //注册页面加载完成需要注册的函数
        WebViewJavascriptBridge.callHandler("PageLoadingFinish", {}, function (responseData) {
            console.log("初始化"+JSON.stringify(responseData));
            window.webEvn=responseData;
            callback();
        });
    }

    /**
     * 文件上传对象
     * @param {Function} callback [description]
     */
    this.FileUpload = function (callback,data) {
        var data=data||this.uploadFlagTask;
        if (debugStatus) {
            callback({
                "status": 1,
                "image": {
                    url: "Public/Home/image/task/second/2016-08-27/57c10e8beb565.jpg",
                    image_id: 143
                    // url : 'Public/Home/image/user/second/2016-08-27/57c1252e10200.jpg',
                    // image_id: 95
                }
            });
            return;
        }
        if (typeof(data) == "object") {
            data = JSON.stringify(data);
        }
        WebViewJavascriptBridge.callHandler("AndroidFileUpload", data, function (responseData) {
            console.log("文件上传对象:"+JSON.stringify(responseData));
            callback(responseData);
        });
    }
    /**
     * 弹出判断是否的提示框
     * @param {[type]}   title    [description]
     * @param {[type]}   content  [description]
     * @param {Function} callback [description]
     */
    this.Alert = function (title, content, callback) {
        if (debugStatus) {
            var reuslt = confirm(content);
            callback({"status": reuslt, "info": "无"});
        }
        title = arguments[0] || "提示";
        content = arguments[1] || "";
        WebViewJavascriptBridge.callHandler("AlertDialog", {"title":title,"content":content}, function (responseData) {
            callback(responseData);
        });
    }

    /**
     * 提示消息tip
     * @param  {[type]} messge [需要弹出提示的字符串]
     * @return {[type]}        [description]
     */
    this.showTip = function (messge,callback) {
        var callback=callback||function(){}
        if (debugStatus) {
            alert(messge);
            return;
        }
        WebViewJavascriptBridge.callHandler("SnakeBar", messge, function (responseData) {
            callback();
        });
    }

    /**
     * 结束当前页面
     * @param {Function} callback [description]
     */
    this.Finish=function(){
        if(debugStatus){
            window.close();
            return;
        }
        WebViewJavascriptBridge.callHandler("Finish",function(responseData){});
    }

    /**
     * 载入
     * @param {[type]}   show     [description]
     * @param {Function} callback [description]
     */
    this.Loading = function (show, callback) {
        if (typeof(data) == "object") {
            data = JSON.stringify(data);
        }
        if (show) {
            WebViewJavascriptBridge.callHandler("PopupWindow", "", function (responseData) {
                callback(responseData);
            });
        } else {
            WebViewJavascriptBridge.callHandler("PopupWindowClose", "", function (responseData) {
                callback(responseData);
            });
        }
    }

    /**
     * 异步请求  支持跨域请求
     * @param {[type]}   data     [{"uri":""}}]
     * @param {Function} callback [description]
     */
    this.Ajax = function (data, callback) {
        if (debugStatus) {
            if (typeof(data) != "object") {
                var data = JSON.parse(data);
            }
            $.post(data.url, data, function (data, textStatus, xhr) {
                var dataObj=JSON.parse(data);
                callback(dataObj, textStatus, xhr);
            });
            //     .error(function () {
            //     console.log("请求失败");
            // });
            return;
        }
        if (typeof(data) == "object") {
            data = JSON.stringify(data);
        }
        WebViewJavascriptBridge.callHandler("WebViewAjax", data, function (responseData) {
            callback(responseData);
        });
    }

    /**
     * 打开和关闭mune
     * @param  {[type]}   is         [description]
     * @param  {Function} callback   [description]
     * @param  {[type]}   resultData [description]
     * @return {[type]}              [description]
     */
    this.Mune = function (callback) {
        if (debugStatus) {
            alert("打开菜单");
            return;
        }
        WebViewJavascriptBridge.callHandler("Mune", {}, function (responseData) {
            callback(responseData);
        });
    }

    this.Auth = function (callback) {
        var callback=callback||function(){}
        if (debugStatus) {
            alert("登陆判断");
            return;
        }
        WebViewJavascriptBridge.callHandler("Auth", {}, function (responseData) {
            callback(responseData);
        });
    }

    /**
     * 支付接口
     * @param {[type]}   payinfo  [支付参数  title content money]
     * @param {Function} callback [回调函数]
     */
    this.Pay=function(payinfo,callback){
        var callback=callback||function(data){}
        if(this.EmptyUnit(payinfo.title)||this.EmptyUnit(payinfo.content)||this.EmptyUnit(payinfo.money)||this.EmptyUnit(payinfo.trandno)){
        // if(this.EmptyUnit(payinfo.title)||this.EmptyUnit(payinfo.content)||this.EmptyUnit(payinfo.money)){
            console.log("支付参数错误");
            return;
        }
        if(debugStatus){
            alert("调起了支付接口");
            var data={
                "status":1,
                "info":"支付成功"
            }
            callback(data);
            return;
        }
        console.log("调用pay");
        console.log(callback);
        WebViewJavascriptBridge.callHandler("Pay",payinfo,function(responseData){
            console.log(JSON.stringify(responseData));
            console.log("asdasdf");
            callback(responseData);
        });
    }

    this.Location=function(callback,only_city){
        var only_city=only_city||false;
        var callback=callback||function(data){}
        if(debugStatus){
            alert("调用了location");
            var locationData={
                "latitude":1.0,
                "lontitude":1.0,
                "radius":1,
                "addr":"福州市",
                "id":44
            }
            callback(locationData);
        }
        WebViewJavascriptBridge.callHandler("Location",{"only_city":only_city},function(responseData){
                    console.log(JSON.stringify(responseData));
                    callback(responseData);
        });
    }

    this.EmptyUnit=function(obj){
        if(obj==""||obj==null){
            return true;
        }
        return false;
    }

    this.ImageShow=function(data){
        if(debugStatus){
            window.location.href=data.remoteUrl;
            return;
        }
        WebViewJavascriptBridge.callHandler("ImageShow",data,function(responseData){});
    }


    /**
     * 城市选择器
     */
    this.CityChooce=function(callback){
         var callback=callback||function(data){}
        if(debugStatus){
            console.log("调用了城市选择的页面");
            callback({
                'city_id': 44,
                "city_name": '福州'
            })
        }
        WebViewJavascriptBridge.callHandler("CityChooce",{},function(responseData){
                callback(responseData);
        });
    }

    /**
     * 注册可以被java调用的函数
     * @param  {[type]}   keyword    [函数名称]
     * @param  {Function} callback   [回调函数]
     * @param  {[type]}   javaCallBack [处理java返回的数据,处理返回数据给java]
     * @return {[type]}                [description]
     */
    this.registerJavaScriptHandler = function (keyword, callback,javaCallBack) {
        //注册被java调用的函数
        WebViewJavascriptBridge.registerHandler(keyword, function (data, responseCallback) {
            console.log(keyword);
            var callData=callback();
            responseCallback(callData);//返回数据给java
            javaCallBack(data);//处理java返回的数据
        });
    }
}
